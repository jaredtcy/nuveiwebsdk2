<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Nuvei WebSDK 2.0 â€“ Debug Test</title>
  <script src="https://cdn.safecharge.com/safecharge_resources/v1/websdk/websdk2.0.js"></script>
  <style>
    body { font-family: sans-serif; max-width: 500px; margin: 30px auto; }
    .input { border: 1px solid #ccc; padding: 6px; min-height: 32px; margin:4px 0; }
    label { display:block; margin-top:12px; }
    button { margin-top:20px; padding:8px 16px; }
  </style>
</head>
<body>

<h2>Nuvei WebSDK 2.0 Debug Test</h2>

<label>Session ID (from /orders)
  <input type="text" id="sessionId" placeholder="paste sessionId here">
</label>

<label>Card Holder Name
  <input type="text" id="cardHolderName" value="CL-BRW1">
</label>

<label>Card Number
  <div id="card-number" class="input"></div>
</label>

<label>Expiration Date
  <div id="card-expiry" class="input"></div>
</label>

<label>CVV
  <div id="card-cvc" class="input"></div>
</label>

<button id="initBtn" onclick="initSDK()">Init SDK</button>
<button id="submitBtn" onclick="payment()" disabled>Submit Payment</button>

<script>
let nuveiWebSDK;

function initSDK() {
  const sId = document.getElementById('sessionId').value.trim();
  if (!sId) return alert('Paste a sessionId first');

  console.log('Initializing Nuvei SDK with session:', sId);

  nuveiWebSDK = webSDK({
    env: 'int',
    sessionId: sId,
    debug: true, // enable verbose logging
    onResult: res => console.log('onResult callback:', res)
  });

  const nuveiFields = nuveiWebSDK.fields({ locale: 'US' });
  const fieldClasses = { base: 'input' };

  // Create fields and attach
  const cardNumber = nuveiFields.create('ccNumber', { classes: fieldClasses });
  cardNumber.attach('#card-number');

  const cardExpiry = nuveiFields.create('ccExpiration', { classes: fieldClasses });
  cardExpiry.attach('#card-expiry');

  const cardCvc = nuveiFields.create('ccCvc', { classes: fieldClasses });
  cardCvc.attach('#card-cvc');

  // Save field references for debugging
  window.debugFields = { cardNumber, cardExpiry, cardCvc };

  // Log field objects
  console.log('Field instances created:', window.debugFields);

  // Verify DOM attachment
  console.log('DOM elements after attach:');
  console.log('card-number div:', document.getElementById('card-number'));
  console.log('card-expiry div:', document.getElementById('card-expiry'));
  console.log('card-cvc div:', document.getElementById('card-cvc'));

  // Enable Submit button after SDK init
  document.getElementById('submitBtn').disabled = false;

  console.log('Nuvei SDK initialized successfully. Submit button enabled.');
}

function payment() {
  if (!nuveiWebSDK) return alert('Initialize SDK first');

  // Log current field states for debugging
  console.log('Preparing to send payment. Field states:');
  console.log('CC Number:', window.debugFields.cardNumber.getState());
  console.log('CC Expiration:', window.debugFields.cardExpiry.getState());
  console.log('CC CVC:', window.debugFields.cardCvc.getState());

  // Payment request
  nuveiWebSDK.payment({
    paymentOption: {
      card: {
        cardHolderName: document.getElementById('cardHolderName').value
      }
    },
    useFields: ['ccNumber', 'ccExpiration', 'ccCvc'] // keys must match fields created
  })
  .then(res => console.log('Payment response:', res))
  .catch(err => console.error('Payment error:', err));
}
</script>

</body>
</html>
